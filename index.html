<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Entrenamientos RV</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --primary:#2563eb;
  --scheduled:#fde68a;
  --done:#22c55e;
  --border:#cbd5e1;
  --bg:#f1f5f9;
  --weekend:#e5e7eb;
}
body{
  margin:0;
  font-family:system-ui,-apple-system,sans-serif;
  background:var(--bg);
  padding:1rem;
}
.container{
  max-width:420px;
  margin:auto;
  background:white;
  padding:1rem;
  border-radius:18px;
  box-shadow:0 10px 25px rgba(0,0,0,.15);
}
h1{text-align:center;margin:.2rem 0 .6rem;font-size:1.1rem;}
button{
  padding:.35rem .55rem;
  border-radius:8px;
  border:1px solid var(--border);
  background:white;
  font-size:.75rem;
  cursor:pointer;
}
button.active{
  background:var(--primary);
  color:white;
  border-color:var(--primary);
}
.nav{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.center{display:flex;justify-content:center;margin:.5rem 0;}
.calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:4px;
}
.calendar.past{
  background:repeating-linear-gradient(
    45deg,
    rgba(0,0,0,.03),
    rgba(0,0,0,.03) 4px,
    transparent 4px,
    transparent 8px
  );
  padding:4px;
  border-radius:12px;
}
.day-name{text-align:center;font-size:.7rem;font-weight:600;}
.day{
  height:64px;
  border:1px solid var(--border);
  border-radius:10px;
  text-align:center;
  position:relative;
  cursor:pointer;
  background:white;
}
.day.weekend{background:var(--weekend);}
.day.selected{border:2px solid var(--primary);}
.day.scheduled{background:var(--scheduled);}
.day.done{background:var(--done);color:white;}
.day.done::after{
  content:"âœ”";
  position:absolute;
  top:4px;
  right:6px;
}
.num{margin-top:6px;font-weight:600;}
.time{font-size:.65rem;}
.empty{visibility:hidden;}

.programmer{
  display:flex;
  gap:6px;
  justify-content:center;
  margin:.5rem 0;
}

/* QUICK PROGRAM */
.quick-toggle{display:flex;justify-content:center;margin:.4rem 0;}
.quick-panel{
  display:none;
  border:1px solid var(--border);
  border-radius:12px;
  padding:.6rem;
  font-size:.7rem;
}
.quick-panel.show{display:block;}
.quick-row{
  display:flex;
  align-items:center;
  gap:6px;
  margin-bottom:.5rem;
}
.quick-row strong{width:70px;text-align:right;opacity:.7}

/* CLEAN BAR */
.clean-bar{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
  margin:.6rem 0;
  font-size:.75rem;
}
.clean-bar button{font-size:.7rem;}
.clean-bar span{
  cursor:pointer;
  font-weight:700;
  color:var(--primary);
}

/* HISTORY */
.history{
  border:1px solid var(--border);
  border-radius:10px;
  padding:.5rem;
  margin-top:.6rem;
  font-size:.7rem;
}
.history-grid{
  display:grid;
  grid-template-columns:1fr 1fr auto;
  gap:6px;
  align-items:center;
  text-align:center;
}
.history-grid strong{font-size:.65rem;}
.history input{
  width:48px;
  padding:.25rem;
  font-size:.7rem;
  text-align:center;
}

/* ANUAL */
.annual{
  border-top:1px solid var(--border);
  margin-top:.6rem;
  padding-top:.5rem;
  display:none;
}
.annual.show{display:block;}
.annual-row{
  display:flex;
  gap:6px;
}
.annual-month{
  flex:1;
  font-size:.6rem;
  text-align:center;
}
.annual-bar{
  height:6px;
  background:#e5e7eb;
  border-radius:4px;
  overflow:hidden;
  display:flex;
}
.annual-done{background:var(--done);}
.annual-sched{background:var(--scheduled);}

.toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,.85);
  color:white;
  padding:.5rem .9rem;
  border-radius:14px;
  font-size:.75rem;
  opacity:0;
  transition:.3s;
}
.toast.show{opacity:1;}
</style>
</head>

<body>
<div class="container">

<h1>Entrenamientos RV</h1>

<div class="nav">
  <button onclick="prevMonth()">â—€</button>
  <strong id="label"></strong>
  <button onclick="nextMonth()">â–¶</button>
</div>

<div class="calendar" id="calendar"></div>

<div class="programmer" id="programmer">
  <button onclick="setTime('06:30')">06:30</button>
  <button onclick="setTime('07:00')">07:00</button>
  <button onclick="setTime('07:30')">07:30</button>
  <button onclick="setTime('--:--')">--:--</button>
</div>

<div class="quick-toggle" id="quickToggle">
  <button onclick="toggleQuick()">âš¡ ProgramaciÃ³n rÃ¡pida</button>
</div>

<div class="quick-panel" id="quickPanel">
  <div class="quick-row">
    <strong>DÃ­a</strong>
    <button onclick="toggleQuickDay(1)">L</button>
    <button onclick="toggleQuickDay(2)">M</button>
    <button onclick="toggleQuickDay(3)">W</button>
    <button onclick="toggleQuickDay(4)">J</button>
    <button onclick="toggleQuickDay(5)">V</button>
    <button onclick="toggleQuickDay(6)">S</button>
    <button onclick="toggleQuickDay(0)">D</button>
  </div>
  <div class="quick-row">
    <strong>Hora</strong>
    <button onclick="setQuickTime('06:30')">06:30</button>
    <button onclick="setQuickTime('07:00')">07:00</button>
    <button onclick="setQuickTime('07:30')">07:30</button>
    <button onclick="setQuickTime('--:--')">--:--</button>
  </div>
  <div class="center">
    <button onclick="applyQuick()">Programar</button>
  </div>
</div>

<div class="clean-bar" id="cleanBar">
  <button id="cw" onclick="selectClean('week')">ðŸ§¹ Semana</button>
  <button id="cm" onclick="selectClean('month')">ðŸ—‘ Mes</button>
  <button id="ca" onclick="selectClean('all')">ðŸ”¥ Todo</button>
  <span onclick="executeClean()">Borrar</span>
</div>

<div class="history" id="historyPanel" style="display:none">
  <div class="history-grid">
    <strong>Programados</strong>
    <strong>Realizados</strong>
    <span></span>
    <input id="hPlan" type="number">
    <input id="hDone" type="number">
    <button onclick="saveHistory()">Guardar</button>
  </div>
</div>

<div class="center">
  <button onclick="toggleAnnual()">ðŸ“Š Resumen anual</button>
</div>

<div class="annual" id="annual"></div>

</div>

<div class="toast" id="toast"></div>

<script>
const STORAGE="rv-data", HST="rv-history";
let data=JSON.parse(localStorage.getItem(STORAGE)||"{}");
let history=JSON.parse(localStorage.getItem(HST)||"{}");
let current=new Date(), selected=null;
let quickDays=new Set(), quickTime=null;
let cleanMode=null;

const cal=document.getElementById("calendar"),
label=document.getElementById("label"),
toast=document.getElementById("toast"),
quickPanel=document.getElementById("quickPanel"),
historyPanel=document.getElementById("historyPanel"),
quickToggle=document.getElementById("quickToggle"),
programmer=document.getElementById("programmer"),
cleanBar=document.getElementById("cleanBar"),
annual=document.getElementById("annual");

const days=["L","M","M","J","V","S","D"];
const months=["E","F","M","A","M","J","J","A","S","O","N","D"];

function save(){
  localStorage.setItem(STORAGE,JSON.stringify(data));
  localStorage.setItem(HST,JSON.stringify(history));
}
function showToast(t){
  toast.textContent=t;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),1500);
}
function isPastMonth(){
  const n=new Date();
  return current.getFullYear()<n.getFullYear() ||
    (current.getFullYear()===n.getFullYear() && current.getMonth()<n.getMonth());
}

/* RENDER */
function render(){
  cal.innerHTML="";
  days.forEach(d=>cal.innerHTML+=`<div class="day-name">${d}</div>`);

  const y=current.getFullYear(), m=current.getMonth();
  label.textContent=`${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][m]} ${y}`;

  const past=isPastMonth();
  cal.classList.toggle("past",past);
  quickToggle.style.display=past?"none":"flex";
  quickPanel.classList.remove("show");
  programmer.style.display=past?"none":"flex";
  cleanBar.style.display=past?"none":"flex";
  historyPanel.style.display=past?"block":"none";

  let first=new Date(y,m,1).getDay()||7;
  let total=new Date(y,m+1,0).getDate();
  let today=new Date(); today.setHours(0,0,0,0);

  for(let i=1;i<first;i++) cal.innerHTML+='<div class="empty"></div>';

  for(let d=1;d<=total;d++){
    let date=new Date(y,m,d); date.setHours(0,0,0,0);
    let key=`${y}-${m}-${d}`;
    let c=document.createElement("div");
    c.className="day";
    if(date.getDay()===0||date.getDay()===6) c.classList.add("weekend");
    if(key===selected) c.classList.add("selected");
    if(data[key]) c.classList.add(data[key].done?"done":"scheduled");
    c.innerHTML=`<div class="num">${d}</div><div class="time">${data[key]?.time||""}</div>`;

    c.onclick=()=>{
      selected=key;
      if(data[key] && date<=today && !past){
        data[key].done=!data[key].done; save();
      }
      render();
    };
    cal.appendChild(c);
  }
}

/* PROGRAMACIÃ“N */
function setTime(t){
  if(!selected||isPastMonth()) return;
  data[selected]={time:t,done:false};
  save(); render();
}

/* QUICK */
function toggleQuick(){ quickPanel.classList.toggle("show"); }
function toggleQuickDay(d){
  quickDays.has(d)?quickDays.delete(d):quickDays.add(d);
  event.target.classList.toggle("active");
}
function setQuickTime(t){
  quickTime=t;
  event.target.parentNode.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");
}
function applyQuick(){
  if(isPastMonth()||!quickTime||!quickDays.size) return;
  let y=current.getFullYear(), m=current.getMonth();
  for(let d=1;d<=31;d++){
    let date=new Date(y,m,d);
    if(date.getMonth()!==m) continue;
    if(quickDays.has(date.getDay())){
      let k=`${y}-${m}-${d}`;
      if(!data[k]) data[k]={time:quickTime,done:false};
    }
  }
  save(); render(); showToast("ProgramaciÃ³n aplicada");
}

/* LIMPIEZA */
function selectClean(m){
  cleanMode=m;
  ["cw","cm","ca"].forEach(id=>document.getElementById(id).classList.remove("active"));
  document.getElementById(m==="week"?"cw":m==="month"?"cm":"ca").classList.add("active");
}
function executeClean(){
  if(!cleanMode){ showToast("Selecciona quÃ© borrar"); return; }
  if(cleanMode!=="all" && !selected){ showToast("Selecciona un dÃ­a"); return; }

  if(cleanMode==="week"){
    let [y,m,d]=selected.split("-").map(Number);
    let base=new Date(y,m,d);
    let start=new Date(base); start.setDate(start.getDate()-((start.getDay()+6)%7));
    let end=new Date(start); end.setDate(start.getDate()+6);
    Object.keys(data).forEach(k=>{
      let [yy,mm,dd]=k.split("-").map(Number);
      let dt=new Date(yy,mm,dd);
      if(dt>=start && dt<=end) delete data[k];
    });
    showToast("Semana borrada");
  }
  if(cleanMode==="month"){
    let [y,m]=selected.split("-").map(Number);
    Object.keys(data).forEach(k=>{
      let [yy,mm]=k.split("-").map(Number);
      if(yy===y && mm===m) delete data[k];
    });
    showToast("Mes borrado");
  }
  if(cleanMode==="all"){
    if(!confirm("Â¿Borrar todo el calendario?")) return;
    data={}; showToast("Todo borrado");
  }
  save(); render();
}

/* HISTÃ“RICO */
function saveHistory(){
  let key=`${current.getFullYear()}-${current.getMonth()}`;
  history[key]={plan:+hPlan.value||0,done:+hDone.value||0};
  save(); showToast("HistÃ³rico guardado");
}

/* ANUAL */
function toggleAnnual(){
  annual.classList.toggle("show");
  renderAnnual();
}
function renderAnnual(){
  annual.innerHTML="";
  let y=current.getFullYear();
  let row=document.createElement("div");
  row.className="annual-row";

  for(let m=0;m<12;m++){
    let plan=0,done=0;
    Object.keys(data).forEach(k=>{
      let [yy,mm]=k.split("-").map(Number);
      if(yy===y&&mm===m){
        plan++;
        if(data[k].done) done++;
      }
    });
    let h=history[`${y}-${m}`];
    if(h){ plan=h.plan; done=h.done; }

    let pct=plan?done/plan:0;
    let c=document.createElement("div");
    c.className="annual-month";
    c.innerHTML=`
      <strong>${months[m]}</strong>
      <div class="annual-bar">
        <div class="annual-done" style="width:${pct*100}%"></div>
        <div class="annual-sched" style="width:${(1-pct)*100}%"></div>
      </div>
      ${done}/${plan}
    `;
    row.appendChild(c);
  }
  annual.appendChild(row);
}

function prevMonth(){ current.setMonth(current.getMonth()-1); selected=null; render(); }
function nextMonth(){ current.setMonth(current.getMonth()+1); selected=null; render(); }

render();
</script>
</body>
</html>
